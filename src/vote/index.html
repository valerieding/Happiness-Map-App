<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport"
          content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <style>
      #campus-map {
        height: 400px;
      }
      html, body {
        height: 400px;
        margin: 0;
        padding: 0;
      }
    </style>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
    integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link href="/static/main.css" rel="stylesheet">
    <!-- <link rel="stylesheet" href="/index_style.css"> -->
    <link href="/static/vote/vote.css" rel="stylesheet">
    <script type="application/javascript" src="/static/vote/vote.js"></script>
    <script type="application/javascript" src="/static/vote/voteMapScript.js"></script>
    <script type="application/javascript" src="/static/jquery-3.2.1.min.js"></script>
    <script type="application/javascript" src="/static/popper.min.js"></script>
    <script type="application/javascript" src="/static/bootstrap4.min.js"></script>
    <title>Vote</title>
  </head>
  <body>
    <script>
      $(function(){
        $("#myNav").load("/static/nav.html")
      });
    </script>
    <script>
      $(document).ready(function(){
        for (let key in log_locs) {
          $("#loc_drop").append('<option value=' + key + '>' + log_locs[key] + '</option>');
        }

        $("#vote_btn").click(function(){
          var drop_loc;
          var map_lock;
          var happy;
          var lock;
          if(currentMapLoc == null) {
            drop_loc = $("#loc_drop option:selected").val();
            if (drop_loc === 'blank')
              drop_loc = '';
            map_loc = $("map_loc").val();
            //alert("map loc = " + map_loc);

            happy = $("input[name=happiness_level]:checked").val();
            
            // for the time being
            loc = drop_loc;

            //var loc = '';
            // map selection should take priority over dropdown selection
            /* if (typeof map_loc != 'undefined') {
                  loc = map_loc;
              }
              else if (typeof map_loc == 'undefined' && typeof drop_loc != 'undefined')
              {
                  loc = drop_loc;
              }
            */
            submitVote(loc, happy);
           // alert(loc + ": " + happy);
           // alert($("#loc_drop option:selected").val());          
           /*
           if (typeof happy != 'undefined' && typeof loc != 'undefined'){
              $.ajax({
                  url: 'request/add_vote',
                  method: 'post',
                  dataType: 'json',
                  data: {'latitude': 10,
                         'longitude': 10,
                         'logical_location': loc,
                         'happiness_level': happy},
                         //'logical_location': $('#loc_drop option:selected').val(),
                         //'happiness_level': $('input[name=happiness_level]:checked').val()},
                  beforeSend: function() {
                    //alert("Happiness level = " + $('input[name=happiness_level]:checked').val());
                    //alert("Location: " + $("#loc_drop option:selected").val());
                    //alert('echo');
                  },
                  success: function() {
                    //alert('Vote Submitted');
                  },
                  error: function() {
                    //alert('Failed to submit vote');
                  }              
              });
            }
            else{
              alert("You have to submit both a happiness value and your location");
            }
            */
          } else {
            happy = $("input[name=happiness_level]:checked").val();
            submitVote(currentMapLoc, happy);
          }
        });
      });
    </script>
    <div class="homepage">
      <div class="cover-container d-flex h-100 p-3 mx-auto flex-column">
        <div id="myNav"></div>
        <main role="main" class="inner cover text-center" id="home-cover">
          <h1 class="cover-heading">Vote</h1>
        </main>
        <form id="vote" method="post">
          <div class="ui">
            <h5> On a scale of 1 (least happy) to 5 (most happy), how happy are you? </h5>
              <div class="radio-label-vertical-wrapper">
                  <label class="radio-label-vertical">
                    <input type="radio" name="happiness_level" value="1">1
                  </label>
                  <label class="radio-label-vertical">
                    <input type="radio" name="happiness_level" value="2">2
                  </label>
                 <label class="radio-label-vertical">
                    <input type="radio" name="happiness_level" value="3">3
                  </label>
                  <label class="radio-label-vertical">
                    <input type="radio" name="happiness_level" value="4">4
                  </label>
                  <label class="radio-label-vertical">
                    <input type="radio" name="happiness_level" value="5">5
                  </label>
                  <br><br>
          <h5> Where are you?</h5>
          <h5> Select from the map or dropdown below.</h5>
            <select id="loc_drop" form="vote" name="location">
              <!--
              <option name="location" value="Location 1">Location 1</option>
              <option name="location" value="Location 2">Location 2</option>
              <option name="location" value="Location 3">Location 3</option>
              <option name="location" value="Location 4">Location 4</option>
              <option name="location" value="Location 5">Location 5</option>
            -->
            </select>
        </div>
        <script>
          var currentMapLoc = null;
        </script>
        <div id="campus-map" name="loc_map"></div>
        <script type="text/javascript" src="/static/vote/voteMapScript.js"></script>
        <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBsbxNy5GODdnbs1MuazTLziaCXJnN9dCM&callback=initMap">
        </script>
        <div>
          <button id="vote_btn"> Submit Vote </button>
        </div> 
    </form>
    </div>
  </body>
</html>
