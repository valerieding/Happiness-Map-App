<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport"
          content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <style>
      #campus-map {
        height: 400px;
      }
      html, body {
        height: 400px;
        margin: 0;
        padding: 0;
      }
    </style>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
    integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link href="/static/main.css" rel="stylesheet">
    <!-- <link rel="stylesheet" href="/index_style.css"> -->
    <link href="/static/vote/vote.css" rel="stylesheet">
    <script type="application/javascript" src="/static/vote/vote.js"></script>
    <script type="application/javascript" src="/static/vote/voteMapScript.js"></script>
    <script type="application/javascript" src="/static/jquery-3.2.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
      integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous">
    </script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
      integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous">
    </script>
    <script type="application/javascript" src="/static/board/board.js"></script>

    <title>Vote</title>
  </head>
  <body>


<!-- Defining onClick Functions for buttons below -->
    <script>
      $(function(){
        $("#myNav").load("/static/nav.html")
      });
    </script>
    <script>
      $(document).ready(function(){
        for (let key in log_locs) {
          $("#loc_drop").append('<option value=' + key + '>' + log_locs[key] + '</option>');
        }

        $("#vote_btn").click(function(){
          var drop_loc;
          var map_lock;
          var happy;
          var lock;
          if(currentMapLoc == null) {
            alert("ERROR: loc==null");
            /*drop_loc = $("#loc_drop option:selected").val();
            if (drop_loc === 'blank')
              drop_loc = '';
            map_loc = $("map_loc").val();
            //alert("map loc = " + map_loc);

            happy = $("input[name=happiness_level]:checked").val();

            // for the time being
            loc = drop_loc;*/
          } else {
            happy = $("input[name=happiness_level]:checked").val();
            loc = currentMapLoc;
            var confirmText = "(" + happy + ")\n";
            var confirmed = true;
            if(autoLoc == true) {
               confirmText += "We auto-detected your location is: " + loc + ".\nIf this is correct click Okay, otherwise please\nclick Cancel and manually select your\nlocation to submit your vote.";
            } 
            if(loc == 'offcampus') {
              confirmText += "You input that you are off campus.\nIf this is correct click Okay, otherwise please\nclick Cancel and manually select your\nlocation to submit your vote.";
            }
            if(loc == '' || loc == ' ' || loc == null) {
              confirmText += "Oops! We couldn't get your location.\nPlease select your location manually to\nsubmit your vote.";
              alert(confirmText);
            } else {
              if(loc == 'offcampus' || loc == '' || loc == ' '|| autoLoc == true) {
                confirmed = confirm(confirmText);
              }
            }
            if (confirmed == true) {
              submitVote(loc, happy);
            }
          }
        });
      });
    </script>


<!-- Begin Actual Content -->
    <div class="homepage">
      <div id = "a" class="cover-container d-flex h-100 p-3 mx-auto flex-column">
        <div id="myNav"></div>
        <main role="main" class="inner cover text-center" id="home-cover">
          <h1 class="cover-heading">Vote</h1>
        </main>


<!-- Initially hidden elements, unhiden after voting -->
        <div id = "post_after_vote" class="form-group" style="float:left;">
          <main role="main" class="inner cover text-center" id="home-cover">
            <h4 class="cover-heading" style="color:white;">Your vote has been submitted!</h4>
        <div style="text-align: center;">
        <form style="display:inline;padding-left:0px;width:200px" id="recent" method="post" >
            <button id="change_vote" type="button" class="btn btn-danger">Change vote</button>
        </form>
        <form style="display:inline;padding-left:100px;width:1000px" id="recent" method="post" >
            <button id="view_map" type="button" onClick="location.href='/map'" class="btn btn-danger">View Map</button>
        </form>
        <form style="display:inline;padding-left:100px;width:200px" id="recent" method="post" >
            <button id="view_board" type="button" onClick="location.href='/board'" class="btn btn-danger">View Messages</button>
        </form>
        <BR>
        <BR>
        <BR>
            <h3 class="cover-heading" style="color:white;">What's On Your Mind?</h1>
            <!-- welcome text only refreshes on page reload
                 should refresh after submitting a vote -->
            <div class="ui" id="welcome"></div> 
          </main>
          <form  style="display:inline;"id="myform" method="post">
            <input type="text" class="form-control" id="exampleInputName2" placeholder="Let the world know!" name="message">
            <BR>
            <button type="submit" style="display:block;" onclick="window.location.reload()" class="btn btn-primary">Submit</button>
          </form>
        </div>


<!-- Voting UI begins here: -->
        <form id="vote" method="post">
          <div id="vote_ui" class="ui">
            <h5> On a scale of 1 (least happy) to 5 (most happy), how happy are you? </h5>
              <div class="radio-label-vertical-wrapper">
                  <label class="radio-label-vertical">
                    <input type="radio" name="happiness_level" value="1">1
                  </label>
                  <label class="radio-label-vertical">
                    <input type="radio" name="happiness_level" value="2">2
                  </label>
                 <label class="radio-label-vertical">
                    <input type="radio" name="happiness_level" value="3">3
                  </label>
                  <label class="radio-label-vertical">
                    <input type="radio" name="happiness_level" value="4">4
                  </label>
                  <label class="radio-label-vertical">
                    <input type="radio" name="happiness_level" value="5">5
                  </label>
                  <br><br>
          <h5> Where are you?</h5>
          <h5> Select from the map or dropdown below.</h5>
            <select id="loc_drop" form="vote" name="location" onchange="onSelectChange()">
            </select>
        </div>
        <script>
          var currentMapLoc = null;
          var autoLoc = true;
          function onSelectChange() {
            var sel = document.getElementById("loc_drop").value;
            //alert(sel);
            if(sel != null) {
              currentMapLoc = sel;
            }
          }
        </script>
        <div id="campus-map" name="loc_map"></div>
        <script type="text/javascript" src="/static/vote/voteMapScript.js"></script>
        <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBsbxNy5GODdnbs1MuazTLziaCXJnN9dCM&callback=initMap">
        </script>
        <div>
          <button type="button" id="vote_btn"> Submit Vote </button>
        </div>
    </form>
    </div>


<!-- End of content, begin Scripts -->
    <div>
      <script type="application/javascript">
        var hidden = 1;
        $( "#vote_btn" ).click(function() {
          if(hidden == 0) {
            $('#post_after_vote').hide();
            $('#vote_ui').show();
            $('#campus-map').show();
            hidden = 1;
          } else {
            $('#post_after_vote').show();
            $('#vote_ui').hide();
            $('#campus-map').hide();
            hidden = 0;
          }

        });
        $( "#change_vote" ).click(function() {
          if(hidden == 0) {
            $('#post_after_vote').hide();
            $('#vote_ui').show();
            $('#campus-map').show();
            hidden = 1;
          } 
        });
        $('#post_after_vote').hide();
        snapToCurrentLoc(navigator, map, marker, geocoder);
      </script>
    </div>
  </body>
</html>
